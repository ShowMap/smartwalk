EntityViewModelExtended=function(n,t){var i=this;EntityViewModelExtended.superClass_.constructor.call(i,t);i.settings=n;i.model=new EntityViewModel(t);i.contactsManager=new VmItemsManager(i.model.contacts,function(){return new ContactViewModel({Type:sw.vm.ContactType.Url})},{beforeEdit:function(){i.addressesManager.cancelAll()},beforeSave:function(n){n.errors||EntityViewModelExtended.setupContactValidation(n,i.settings)},itemView:i.settings.contactView,itemEditView:i.settings.contactEditView});i.addressesManager=new VmItemsManager(i.model.addresses,function(){return new AddressViewModel({})},{initItem:function(n){EntityViewModelExtended.initAddressViewModel(n)},beforeEdit:function(){i.contactsManager.cancelAll()},beforeSave:function(n){n.errors||EntityViewModelExtended.setupAddressValidation(n,i.settings)},itemView:i.settings.addressView,itemEditView:i.settings.addressEditView});i.uploadManager=new FileUploadManager(i);i.getContactType=function(n){return i.settings.contactTypes[n.type()]};i.model.toTinyJSON=function(){return{Id:i.model.id(),Type:i.model.type(),Name:i.model.name()}};i.saveEntity=function(t){return(i.model.errors||EntityViewModelExtended.setupValidation(i.model,n),i.model.isValidating())?(setTimeout(function(){i.saveEntity(t)},50),!1):(i.model.errors().length==0?(i.isBusy(!0),i.uploadManager.request.done(function(){i._saveEntity(t)})):i.model.errors.showAllMessages(),!0)};i._saveEntity=function(n){i.request=sw.ajaxJsonRequest(i.model.toJSON(),i.settings.entitySaveUrl,i).done(function(r){n&&$.isFunction(n)?n(r):(t=r,i.model.loadData(r),i.settings.entityAfterSaveAction(r.Id))}).fail(function(n){i.handleServerError(n)})};i.cancelEntity=function(){i.isBusy()?i.isBusy(!1):i.settings.entityAfterCancelAction()};i.onWindowClose=function(){var r=new EntityViewModel(t);return JSON.stringify(r.toJSON())!=JSON.stringify(i.model.toJSON())?n.unsavedChangesMessage:undefined};EntityViewModelExtended.setupAutocompleteAddress(i)};sw.inherits(EntityViewModelExtended,ViewModelBase);EntityViewModelExtended.setupValidation=function(n,t){n.name.extend({required:{message:t.nameRequiredValidationMessage}}).extend({maxLength:{params:255,message:t.nameLengthValidationMessage}}).extend({asyncValidation:{validationUrl:t.validationUrl,propName:"Name",modelHandler:n.toTinyJSON}});n.description.extend({maxLength:{params:3e3,message:t.descriptionLengthValidationMessage}});n.isValidating=ko.computed(function(){return n.name.isValidating()||n.description.isValidating()});n.errors=ko.validation.group(n)};EntityViewModelExtended.setupContactValidation=function(n,t){n.type.extend({dependencies:[n.contact]});n.contact.extend({required:{params:!0,message:t.contactMessages.contactRequiredValidationMessage}}).extend({maxLength:{params:255,message:t.contactMessages.contactLengthValidationMessage}}).extend({contactValidation:{allowEmpty:!0,contactType:n.type,messages:t.contactMessages}});n.title.extend({maxLength:{params:255,message:t.contactMessages.contactTitleValidationMessage}});n.errors=ko.validation.group(n)};EntityViewModelExtended.setupAddressValidation=function(n,t){n.address.extend({maxLength:{params:255,message:t.addressMessages.addressLengthValidationMessage}});n.latitude.extend({number:!0}).extend({notEqual:"0"}).extend({min:-90}).extend({max:90}).extend({required:{params:!0,message:t.addressMessages.addressLatitudeValidationMessage}});n.longitude.extend({number:!0}).extend({notEqual:"0"}).extend({min:-180}).extend({max:180}).extend({required:{params:!0,message:t.addressMessages.addressLongitudeValidationMessage}});n.tip.extend({maxLength:{params:255,message:t.addressMessages.addressTipValidationMessage}});n.errors=ko.validation.group(n)};EntityViewModelExtended.setupAutocompleteAddress=function(n){typeof google!="undefined"&&typeof google.maps!="undefined"?(n.geocoder=new google.maps.Geocoder,n.getAutocompleteAddresses=function(t,i){n.geocoder.geocode({address:t},function(n,t){t==google.maps.GeocoderStatus.OK?i(n):i(null)})}):n.getAutocompleteAddresses=function(){return null}};EntityViewModelExtended.initAddressViewModel=function(n){n.mapPoint=ko.computed({read:function(){return n.latitude()&&n.longitude()?{lat:n.latitude(),lng:n.longitude()}:undefined},write:function(t){n.latitude(t?t.lat:undefined);n.longitude(t?t.lng:undefined)}});n.addressData=ko.computed({read:function(){return{formatted_address:n.address()||null}},write:function(t){t&&t.geometry&&t.geometry.location&&n.mapPoint(ko.googleMap.toSWLatLng(t.geometry.location))}})};
/*
//# sourceMappingURL=sw-editing-entity.min.js.map
*/