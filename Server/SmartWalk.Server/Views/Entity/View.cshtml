@using SmartWalk.Server.Records
@using SmartWalk.Server.ViewModels
@using System.Text.RegularExpressions
@model ViewParametersVm
@{
    var item = (EntityVm)Model.Data; 
}

@if (item.AllAddresses.Any()) {
    var addressFirst = item.AllAddresses.First();
    var query = Regex.Replace(addressFirst.Address.Replace("&", " "), @",\s+", ",");
    query = Regex.Replace(query, @"\s+", "+");
<div class="map-container"><iframe src="https://www.google.com/maps/embed/v1/place?q=@query&key=AIzaSyAOwfPuE85Mkr-xoNghkIB7enlmL0llMgo"></iframe></div>
}
        
<div class="row gap">
    <div class="col-md-7"><p class="description">@item.Description</p></div>
    <div class="col-md-5 contact-container">
    @if (item.AllContacts.Any()) {
        <div class="well">
            <h4 class="text-center">@T("Contacts and Links")</h4>
            <dl class="dl-horizontal">
    @foreach (var contact in item.AllContacts) {
        var title = contact.Title ?? contact.Contact;                             
                             
        switch ((ContactType)contact.Type) {
            case ContactType.Url:
                var url = contact.Contact.StartsWith("http") ? contact.Contact : string.Format("http://{0}", contact.Contact);
                <dt>@T("web"):</dt>
                <dd><a href="@url">@title</a></dd>
                break;
            case ContactType.Phone:
                <dt>@T("phone"):</dt>
                <dd>@contact.Contact</dd>
                break;
            case ContactType.Email:
                <dt>@T("email"):</dt>
                <dd><a href="mailto:@contact.Contact">@title</a></dd>
                break;
        }
    }
            </dl>
        </div>   
    }                
    </div>
</div>

<!--<textarea style="width: 100%" id="tasks" data-bind="value: ko.toJSON($root)"></textarea>-->

<table class="table table-content" data-bind="visible: EventItems().length > 0">
    <thead>
        <tr><th><h4>@T("Recent Events")</h4></th><th>@T("Date")</th></tr>
    </thead>
    <tbody data-bind='template: {name: "eventItemTemplate", foreach: EventItems() }'></tbody>
</table>        

<script type="text/html" id="eventItemTemplate">
    <tr>
        <td>
            <a data-bind="attr: {href: '/event/'+Id()}, text: Title"></a><br/>
            <span class="description" data-bind="text: Description"></span>
        </td>
        <td data-bind="text: StartTime"></td>        
    </tr>       
</script>

@using (Script.Foot())
{
<script type="text/javascript">
    $(function() {
        $("img.scale").imageScale();
        $("p.description").textCollapse($(".contact-container").first().height());
    });
</script>
}